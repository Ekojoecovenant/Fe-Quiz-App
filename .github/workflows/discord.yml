name: Discord Notification

on: push

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    steps:
      # - name: Send Discord Notification
      #   run: |
      #     curl -H "Content-Type: application/json" \
      #     -d "{\"content\": \"ðŸš€ A push just happened on **${GITHUB_REPOSITORY}** by **${GITHUB_ACTOR}**.\n\nðŸ“ Commit message: ${GITHUB_HEAD_REF:-$GITHUB_REF_NAME}\nðŸ”— Check it here: ${GITHUB_SERVER_URL}/${GITHUB_REPOSITORY}/commit/${GITHUB_SHA}\"}" \
      #     ${{ secrets.DISCORD_WEBHOOK_URL }

      - name: Set message
        id: msg
        run: |
          echo "msg=ðŸš€ A push just happened on **${GITHUB_REPOSITORY}** by **${GITHUB_ACTOR}**.\n\nðŸ“ Commit message: ${GITHUB_HEAD_REF:-$GITHUB_REF_NAME}\nðŸ”— Check it here: ${GITHUB_SERVER_URL}/${GITHUB_REPOSITORY}/commit/${GITHUB_SHA}" >> $GITHUB_OUTPUT

      # Discord notification
      - name: Send Discord Notification
        uses: Ilshidur/action-discord@0.4.0
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
        with:
          args: "${{ steps.msg.outputs.msg }}"

      # âœ… Email notification
      - name: Send Email Notification
        uses: dawidd6/action-send-mail@master
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.EMAIL_USER }}
          password: ${{ secrets.EMAIL_PASS }}
          subject: "GitHub Issue Notification"
          to: covenantekojoe@gmail.com
          from: GitHub Actions
          body: ${{ steps.msg.outputs.msg }}
