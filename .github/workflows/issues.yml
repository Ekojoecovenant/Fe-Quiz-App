name: Issue Notifications

on:
  issues:
    types: [opened, edited, closed, reopened]

permissions:
  issues: read

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Debug event
        run: |
          echo "Action: ${{ github.event.action }}"
          echo "Title: ${{ github.event.issue.title }}"

      - name: Set custom message
        id: msg
        run: |
          if [ "${{ github.event.action }}" = "opened" ]; then
            echo "msg=🟢 New Issue Opened: #${{ github.event.issue.number }} - ${{ github.event.issue.title }}" >> $GITHUB_OUTPUT
          elif [ "${{ github.event.action }}" = "edited" ]; then
            echo "msg=✏️ Issue Edited: #${{ github.event.issue.number }} - ${{ github.event.issue.title }}" >> $GITHUB_OUTPUT
          elif [ "${{ github.event.action }}" = "closed" ]; then
            echo "msg=🔴 Issue Closed: #${{ github.event.issue.number }} - ${{ github.event.issue.title }}" >> $GITHUB_OUTPUT
          elif [ "${{ github.event.action }}" = "reopened" ]; then
            echo "msg=♻️ Issue Reopened: #${{ github.event.issue.number }} - ${{ github.event.issue.title }}" >> $GITHUB_OUTPUT
          fi

      - name: Show final msg
        run: echo "${{ steps.msg.outputs.msg }}"

      - name: Send to Discord
        uses: Ilshidur/action-discord@0.4.0
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK_URL }}
          args: "${{ steps.msg.outputs.msg }}"

      # ✅ Email notification
      - name: Send Email
        uses: dawidd6/action-send-mail@master
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ${{ secrets.EMAIL_USER }}
          password: ${{ secrets.EMAIL_PASS }}
          subject: "GitHub Issue Notification"
          to: covenantekojoe@gmail.com
          from: GitHub Actions
          body: ${{ steps.msg.outputs.msg }}
